{% extends "time_series_manager/base.html" %}
{% load tethys_gizmos %}
{% load staticfiles %}

{% block header_buttons %}
 <div class="header-button glyphicon-button" data-toggle="tooltip" data-placement="bottom" title="Upload Jupyter Notebook to HydroShare">
    <a data-toggle="modal" data-target="#modalLoadFile"><span class="glyphicon glyphicon-cloud-upload"></span></a>
  </div>
  <div class="header-button glyphicon-button" data-toggle="tooltip" data-placement="bottom" title="Help">
    <a data-toggle="modal" data-target="#instruction-intro-modal"><span class="glyphicon glyphicon-question-sign"></span></a>
  </div>

{% endblock %}
{% block app_navigation_items %}
<p></p>
<h6>Select a Script <a data-toggle="modal" data-target="#help-modal" data-toggle="tooltip" data-placement="bottom" title="Help"><span class="glyphicon glyphicon-question-sign"></span></a></h6>
<div class="input-group">
    <select class="form-control" id="sel1" style="display: inline-block;"></select>
    <span class="input-group-btn"  data-toggle="tooltip" data-placement="left" title="Refresh Script List">
        <button class="btn btn-default" type="button" onclick="refreshScripts()" ><span class="glyphicon glyphicon-refresh" aria-hidden="true" ></span></button>
    </span>
</div>



<hr>
<div >
    <h6>Description <a data-toggle="modal" data-target="#help-modal" data-toggle="tooltip" data-placement="bottom" title="Help"><span class="glyphicon glyphicon-question-sign"></span></a></h6>
  </div>
<div id = "scriptDescription"></div>
<hr>
<h6>Required Variables <a data-toggle="modal" data-target="#help-modal" data-toggle="tooltip" data-placement="bottom" title="Help"><span class="glyphicon glyphicon-question-sign"></span></a></h6>
<div id = "scriptVar"></div>
<hr>
 <!--<button type="button" class="btn btn-info "  data-toggle="modal" data-target="#help-modal" style="float: left; position:relative">-->
        <!--<span id = 'get_data_span' data-toggle="tooltip" data-placement="bottom" title = "Get Data for New Selection" class="glyphicon glyphicon-question-sign"></span>-->
  <!--</button>-->
<p></p>
<button id = "divViewScript" type="button" class="btn btn-info" name="None" onclick="viewScript(this.name)">
    View Script
</button>
 <button type="button" class="btn btn-info" style="float: left; position:relative" onclick="uploadToGoogle()">
     Launch with Google Colaboratory
 </button>






{% endblock %}

{% block app_content %}
<div id="generalAlert"></div>
<div id = "stat_div" >
    <button type="button" class="btn btn-success" style="float: right; position:relative" onclick="get_list_hs_res()" data-toggle="modal" data-target="#modalLoadRes">
        Add Time Series from HydroShare
    </button>
    <table id="data_table" class="display" cellspacing="0" width="100%" style="">
        <thead>
        <tr>
            <!--<th> <div style='text-align:center'><input class = 'checkbox' id ='master_chk' name ='master_chk' data-resid =" + res_id-->
                    <!--+ " type='checkbox' onClick ='series_visiblity_toggle(this.id,this.name);'checked = 'checked'></div></th>-->
            <th>Please assign variable to script</th>
            <th>Organization</th>
            <th>Site Name</th>
            <th>Variable</th>
            <th>Variable Unit</th>
            <th>Quality Control</th>
            <th>Value Count</th>
            <th>View Resource</th>
        </tr>
        </thead>
        <tfoot><tr>
            <th> </th>
            <th>Organization</th>
            <th>Site Name</th>
            <th>Variable</th>
            <th>Variable Unit</th>
            <th>Quality Control</th>
            <th>Value Count</th>
            <th>View Resource</th>
        </tr></tfoot>
    </table>

</div>


{% endblock %}

{# Use the after_app_content block for modals #}
{% block after_app_content %}
  <!-- Example Modal -->
  <div class="modal fade" id="instruction-intro-modal" tabindex="-1" role="dialog" aria-labelledby="help-modal-label">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h5 class="modal-title" id="instruction-intro-label">Welcome to the Time Series Script Manager</h5>
        </div>
        <div class="modal-body">
          <p>This application is designed to aid in the sharing of powerful Python tools called Jupyter Notebooks.
              These notebooks allow Python code to be run completely in cloud as a series of blocks with comments. These
              Notebooks are a powerful tool for instruction and education.
          </p>
          <p>The Time Series Script Manager uses HydroShare as a repository for various Notebooks. It then can package these data
          from the CUAHSI Data Client or from HydroShare directly. The app then uses the user's Google Drive to store the Python Notebooks.
          The advantage of this practice is that the user can edit and save their own copy of the script with the data for future use.
              Google has provided a free interface for running Jupyter Notebooks from users' Google Drives. This app leverages the
              power of this service. In addition,
          this app provides instructions for users uploading and registering their own Notebooks with the app, publicly or privately</p>
        </div>
        <div class="modal-footer">
            <div id="byu-logo-container">
                <img src="{% static 'time_series_script_manager/images/byu-medallion.png' %}"/><span><i>Developed at the BYU Hydroinformatics Lab</i></span>
            </div>
             <a href="https://github.com/mmbayles/TimeSeriesScriptManager" type="button" class="btn btn-info" target="_blank" >Source Code</a>
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <!--<button type="button" class="btn btn-primary" data-dismiss="modal">OK</button>-->
        </div>
      </div>
    </div>
  </div>
<div class="modal fade" id="view-script-modal" tabindex="-1" role="dialog" aria-labelledby="help-modal-label">
    <div class="modal-dialog" style="width:80%;" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h5 class="modal-title" id="view-script-modal-label"></h5>
            </div>
            <div class="modal-body">
                <pre id="scriptViewer"></pre>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal">OK</button>
            </div>
        </div>
    </div>
</div>
{% verbatim %}
<div id="modalLoadFile" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Add Local Jupyter Notebook to HydroShare</h4>
            </div>
            <div class="modal-body">
                <div id = "hsAlert"></div>


                <ul class="nav nav-tabs">
                  <li class="active"><a data-toggle="tab" href="#home">Instructions</a></li>
                  <li><a data-toggle="tab" href="#menu1">Upload a Scripts</a></li>
                </ul>

                <div class="tab-content">
                  <div id="home" class="tab-pane fade in active">
                    <h3>Instructions</h3>
                    <h6>Follow these instructions exactly or your Notebook likely will not be compatible with this application</h6>
                    <ol>
                      <li>HydroShare Resource Requirements</li>
                        To be properly discovered from HydroShare, the abstract needs to have certain tags:
                        #{%Application% Time Series Script Manager%}
                        This tag identifies that the Notebook is compatible with the Time Series Script Manager
                        #{%Title% Time_Series_Comparsion}
                        This tag identifies that the title on your Notebook.
                        #{%Description% Put a short description of your script here }
                        This tag gives a short description of your notebook to other users.
                        #{%TimeSeries% Describe TimeSeries here}
                        This last tag identifies a time series variable. At this time this app only supports variable input
                        of a time series. You can have as many time series as you want but the name in this tag should exactly match
                        the name of the your time series variable in the Notebook
                      <li>Notebook Requirements</li>
                        Each variable listed in the abstract should have two matching components in the script. One component for the dates and
                        the other component for the values. The dates will be output as unix time stamps. An example of the variable convention is shown
                        below
                      <li>Sample Notebook</li>
                        <pre>import numpy as np
import pandas as pd

#Example format of variables
TimeSeries_dates = [1491264000.0, 1491609600.0, 1491696000.0]
TimeSeries_values = [6, 8, 12]

observed_time_series_dates = None
observed_time_series_values = None</pre>

                        <pre>


                        </pre>

                    </ol>
                  </div>

                  <div id="menu1" class="tab-pane fade">
                    <h5>Choose Jupyter Notebook File (.ipynb):</h5>
                    <input id="input-files" type="file">
                    <br>
                    <div id="msg-file" class="hidden"></div>
                    <fieldset id="fields-newRes">
                        <div class="form-group" >
                            <label for="resTitle" class="control-label">Resource Title:</label>
                            <input type="text" class="form-control resField" id="resTitle" placeholder="Resource Title" disabled required>
                        </div>
                        <div class="form-group" >
                            <label for="resAbstract" class="control-label">Resource Abstract:</label>
                            <textarea rows="9" cols="50" id="resAbstract" class="form-control resField "placeholder="Resource Abstract" disabled></textarea>
                        </div>
                        <div class="form-group" disabled>
                            <label for="resKeywords" class="control-label">Resource Keywords (separate values with a comma) :</label>
                            <input type="text" class="form-control resField" id="resKeywords" placeholder="Resource Keywords" disabled>
                        </div>
                    </fieldset>
                  </div>

            </div>
            <div class="modal-footer">
                <div class="button-group flex1-0">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="button" id="btn-upload-file" class="btn btn-default btn-upload" onclick="uploadHydroShare()" disabled>Add</button>
                </div>
            </div>
        </div>
        <!--End modal content-->
    </div>
</div>
</div>
{% endverbatim %}


<!--End modal-->
<div id="modalLoadRes" class="modal fade" role="dialog">

        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Add HydroShare Resource</h4>
                </div>
                <div class="modal-body">
                    <div id = loading_hs>
                        <div class="cssload-loader">
                            <div class="cssload-dot"></div>
                            <div class="cssload-dot"></div>
                            <div class="cssload-dot"></div>
                            <div class="cssload-dot"></div>
                            <div class="cssload-dot"></div>
                        </div>
                    </div>
                     <table id="hs_resource_table" class="display" cellspacing="0" width="100%">
                        <thead>
                        <tr>
                            <!--<th></th>-->
                            <th></th>
                            <th>Title</th>
                            <th>Type</th>
                            <th>Author</th>
                            <th>Last Updated</th>
                            <!--<th>Download Data</th>-->
                        </tr>
                        </thead>
                        <tfoot><tr>

                            <th></th>
                            <th>Title</th>
                            <th>Type</th>
                            <th>Author</th>
                            <th>Last Updated</th>
                            <!--<th>Download Data</th>-->
                        </tr></tfoot>
                    </table>

                </div>
                <div class="modal-footer">
                    <div class="button-group flex1-0">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="button" id="btn-upload-res" class="btn btn-success btn-upload" onClick = "getAddHS()">Add</button>
                    </div>
                </div>
            </div>
            <!--End modal content-->
        </div>
    </div>

<div class="modal fade" id="help-modal" tabindex="-1" role="dialog" aria-labelledby="help-modal-label">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h5 class="modal-title" id="help-modal-label">Welcome to the Time Series Script Manager</h5>
        </div>
        <div class="modal-body">
            <h6>Select a Script</h6>
            <p>From the dropdown, you can select which Jupyter Notebook you would like to view. These Notebooks are stored
            on HydroShare and have special tags to associate them with this application. </p>
            <h6>Description</h6>
             <p>This a description of what the script does and included anythin the author deemed import to include.</p>
            <h6>Required Variables</h6>
          <p>Every Notebook has at least one variable. At this time the only variable type allowed is a time series.
              You need to assoicate each variable in this list with one of the listed time series in the table on the main
              screen.
          </p>
            <h6>View Script (button only appears after selecting a script)</h6>
            <strong>b=Button only appears after selecting a script</strong>
            <p>Clicking this button will allow you to view the raw Python code in each Notebook. Please note that any
            required variable input will be provided by the app.</p>
            <h6>Launch with Google Colaboratory</h6>
            <p>Clicking this button will launch Google Colaboratory with your selected Notebook and data. A new tab will
            open (please note that you may have to enable popups from this site) and launch Google Colaboratory.
            You will be presented with the chosen Notebook with the associated data. You are now free to run and edit the notebook as you see fit.</p>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" data-dismiss="modal">OK</button>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block app_actions %}

{% endblock %}
{% block scripts %}
  {{ block.super }}
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <!--<script src="{% static 'time_series_script_manager/js/google_api.js' %}" type="text/javascript"></script>-->
    <script src="{% static 'time_series_script_manager/js/main.js' %}" type="text/javascript"></script>
    <script src="https://cdn.datatables.net/1.10.10/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.4.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.4.2/js/buttons.print.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.js"></script>
    <script src="https://cdn.datatables.net/plug-ins/1.10.16/api/column().title().js"></script>

{% endblock %}